# TEST_CASES（V0.4 总集成版）- 覆盖 PRD V0.1 ~ V0.4 超大执行用例

## 0. 文档定位
- 文档目标：将 `V0.1` 到 `V0.4` 全部需求并入 `V0.4` 目录，形成单一总测试用例基线。
- 适用场景：版本回归、上线门禁、需求复盘、自动化补齐排期。
- PRD 来源：
  - `/Users/wuhaoyang/Documents/trae_projects/skills/docs/prd/PRD-Skill-Manager-V0.1.md`
  - `/Users/wuhaoyang/Documents/trae_projects/skills/docs/prd/PRD-Skill-Manager-V0.2.md`
  - `/Users/wuhaoyang/Documents/trae_projects/skills/docs/prd/PRD-Skill-Manager-V0.3.md`
  - `/Users/wuhaoyang/Documents/trae_projects/skills/docs/prd/PRD-Skill-Manager-V0.4.md`

## 1. 覆盖范围与边界
### 1.1 覆盖范围
- 导入页：预设工具来源、自定义路径来源、仓库位置、导入触发与结果反馈。
- 启动路由：首启分流（导入页/管理页）、导入后进入管理页。
- 管理页：搜索、单选/多选、批量推送、批量停用、单条切换。
- 配置中心：导入来源管理、推送目标管理、保存/取消、校验约束。
- 数据层：扫描、导入、推送、停用、持久化配置、增量导入规则。

### 1.2 非覆盖范围
- V0.5/V0.6 的用量监测。
- 自动同步、目录监听、后台任务（PRD 明确非目标）。

### 1.3 优先级定义
- `P0`：发布门禁，任一失败禁止发布。
- `P1`：核心行为增强，建议发布前通过。
- `P2`：体验增强，可作为后续补测项。

## 2. 统一业务口径（测试基线）
### 2.1 Skill 识别口径
- 仅当某目录下存在 `SKILL.md` 时，该目录计为 skill。
- 不含 `SKILL.md` 的目录一律忽略。

### 2.2 导入口径
- 主导入（V0.1/V0.2/V0.3）：同名 skill 默认覆盖（后覆盖先）。
- V0.4 配置中心新增路径导入：仅新增，不覆盖同名，已存在项跳过。

### 2.3 推送状态口径
- “已推送”：在当前启用推送目标内均已分发成功。
- “未推送”：至少一个启用推送目标未分发成功。

### 2.4 批量操作口径
- 批量推送：只处理未推送项，已推送项跳过。
- 批量停用：只处理已推送项，未推送项跳过。

### 2.5 V0.4 初始化口径
- 导入完成后首次进入管理页：
  - 若导入页选中过预设工具，默认推送目标=选中过的预设工具。
  - 若仅选了自定义路径，默认推送目标=全部预设工具。
- 非首次进入：沿用上次保存配置，不自动覆盖。

## 3. 测试分层策略
### 3.1 Unit（数据规则）
- 覆盖存储与业务函数：导入、推送、停用、配置、增量导入、初始化逻辑。

### 3.2 Integration（页面流程）
- 覆盖 App 启动分流、管理页批量流程、配置入口联动。

### 3.3 E2E（真实桌面流程）
- 覆盖首屏可用、关键入口点击、主要文案稳定可见。

### 3.4 稳定性补测（自动化 + 人工）
- 自动化覆盖：结构稳定、布局不崩、边界文案可见。
- 人工补测：视觉质感与系统权限弹窗体验。

## 4. 测试环境与固定夹具
### 4.1 环境
- OS：macOS
- 应用：Electron + React
- 自动化：Vitest + Playwright

### 4.2 固定目录夹具
- 中央仓库：`~/Documents/SkillManager/`
- 预设工具：
  - `~/.claude/skills/`
  - `~/.codex/skills/`
  - `~/.cursor/skills/`
  - `~/.trae/skills/`

### 4.3 数据夹具（建议）
- `commit-helper`：跨工具重复 skill（用于去重/覆盖/跳过验证）。
- `code-review`：常规 skill。
- `manga-generator`：常规 skill。
- `invalid-folder`：无 `SKILL.md` 目录。
- `broken-permission-path`：无权限目录。

---

## 5. 阶段A：V0.1 导入与管理分发基础

### A-01（P0）导入页默认进入与初始状态
- 类型：Integration
- 关联：V0.1 US-01
- 前置：中央仓库为空。
- 步骤：
  1. 启动应用。
  2. 观察首屏页面。
- FE 正常断言：
  - 进入导入页。
  - 工具卡片可见。
  - 一键导入按钮初始禁用。
- FE 异常断言：
  - 快速重复点击禁用按钮不触发导入。
- BE 断言：
  - 不发生导入写操作。
- 自动化：已覆盖（`App.v04.entry.test.jsx`）。

### A-02（P0）工具卡片多选与计数联动
- 类型：Integration
- 关联：V0.1 US-01
- 前置：导入页可见。
- 步骤：
  1. 依次勾选 2 个工具。
  2. 再取消 1 个工具。
- FE 正常断言：
  - 卡片高亮与勾选状态一致。
  - 底部“已选 X 个工具”实时更新。
  - 选中 >= 1 时导入按钮可点击。
- FE 异常断言：
  - 取消到 0 后按钮恢复禁用。
- 自动化：已落地（`ImportPage.v04.full-flow.test.jsx`）。

### A-03（P0）导入成功后跳转管理页
- 类型：Integration
- 关联：V0.1 US-01
- 前置：至少选中 1 个来源且存在可导入 skill。
- 步骤：
  1. 点击一键导入。
  2. 等待导入完成。
- FE 正常断言：
  - 显示成功 Toast。
  - 自动跳转管理页。
- FE 异常断言：
  - 导入失败时不跳转并提示原因。
- BE 正常断言：
  - 返回导入成功数量。
- BE 异常断言：
  - 返回失败明细可展示。
- 自动化：已落地（`ImportPage.v04.full-flow.test.jsx`）。

### A-04（P0）同名 skill 去重（V0.1 语义）
- 类型：Unit
- 关联：V0.1 US-01 场景2
- 前置：两个来源均含 `commit-helper`。
- 步骤：执行导入。
- BE 正常断言：
  - 中央仓库最终仅 1 个 `commit-helper`。
- BE 异常断言：
  - 无重复目录残留。
- 自动化：已覆盖（`data.v04.regression.test.js`）。

### A-05（P1）管理页工具切换刷新状态
- 类型：Integration
- 关联：V0.1 US-02
- 前置：已进入管理页。
- 步骤：Claude -> CodeX -> Cursor 切换。
- FE 正常断言：
  - 每次切换后状态标签按当前工具更新。
- FE 异常断言：
  - 快速连续切换不出现空白或卡死。
- 自动化：已落地（本轮补齐）。

### A-06（P1）搜索过滤（名称/描述）
- 类型：Integration
- 关联：V0.1 US-02
- 前置：管理页有多条 skill。
- 步骤：输入 `commit`。
- FE 正常断言：
  - 仅保留名称或描述包含 `commit` 的项。
- FE 异常断言：
  - 清空搜索后列表恢复。
- 自动化：已落地（本轮补齐）。

### A-07（P0）混合选中时按钮文案逻辑
- 类型：Integration
- 关联：V0.1 US-03
- 前置：选中包含已推送+未推送。
- 步骤：观察底部按钮。
- FE 正常断言：
  - 按钮显示“推送选中”。
- FE 异常断言：
  - 不应错误显示“取消推送”。
- 自动化：已落地（本轮补齐）。

### A-08（P0）批量推送成功反馈
- 类型：Integration
- 关联：V0.1 US-03 场景1
- 前置：选中 2 个未推送项。
- 步骤：点击“推送选中”。
- FE 正常断言：
  - Toast 显示推送成功数量与工具名。
  - 列表状态更新为已推送。
- BE 正常断言：
  - 推送函数调用次数与目标数量匹配。
- 自动化：已覆盖主路径（`ManagePage.v04.batch-flow.test.jsx`）。

### A-09（P0）批量取消推送成功反馈
- 类型：Integration
- 关联：V0.1 US-03 场景2
- 前置：选中 2 个已推送项。
- 步骤：点击“取消推送”。
- FE 正常断言：
  - Toast 显示取消成功数量。
  - 列表状态更新为未推送。
- BE 正常断言：
  - 删除调用与目标数量匹配。
- 自动化：已覆盖主路径（`ManagePage.v04.batch-flow.test.jsx`）。

### A-10（P1）无选中项时操作按钮禁用
- 类型：Integration
- 关联：V0.1 US-03
- 前置：管理页无选中项。
- 步骤：尝试触发批量操作。
- FE 正常断言：
  - 按钮禁用。
- FE 异常断言：
  - 不触发后端调用。
- 自动化：已落地（本轮补齐）。

---

## 6. 阶段B：V0.2 真实文件系统接入

### B-01（P0）工具目录扫描统计（正常）
- 类型：Unit
- 关联：V0.2 US-01 场景1
- 前置：目标目录含多个 skill 目录且均含 `SKILL.md`。
- 步骤：执行扫描。
- BE 正常断言：
  - 返回数量正确。
  - 每个 skill 名称与描述可解析。
- 自动化：已落地（`data.v04.full-coverage.test.js`）。

### B-02（P0）目录不存在降级
- 类型：Unit
- 关联：V0.2 US-01 场景2
- 前置：某工具目录不存在。
- 步骤：执行扫描。
- BE 正常断言：
  - 返回 0 个 skill。
  - 不抛未捕获异常。
- 自动化：已落地（本轮补齐）。

### B-03（P0）目录无权限读取
- 类型：Unit
- 关联：V0.2 US-01 异常
- 前置：扫描路径无读权限。
- 步骤：执行扫描。
- BE 正常断言：
  - 返回 `PERMISSION_DENIED` 或等价错误码。
- FE 断言：
  - 显示“无法访问”或明确失败提示。
- 自动化：已落地（本轮补齐）。

### B-04（P0）主导入同名覆盖（后覆盖先）
- 类型：Unit
- 关联：V0.2 US-02 场景2
- 前置：中央仓库已存在同名 skill。
- 步骤：再次导入同名 skill。
- BE 正常断言：
  - 覆盖成功。
  - 内容更新为新来源版本。
- 自动化：已覆盖（`data.v04.regression.test.js`）。

### B-05（P0）首次/后续启动分流
- 类型：Integration
- 关联：V0.2 US-02 场景3
- 前置：准备“仓库为空”和“仓库有数据”两组。
- 步骤：分别启动应用。
- FE 正常断言：
  - 空仓库 -> 导入页。
  - 有数据 -> 管理页。
- 自动化：已覆盖（`App.v04.entry.test.jsx`）。

### B-06（P0）推送到目标工具目录
- 类型：Unit + Integration
- 关联：V0.2 US-04 场景1
- 前置：中央仓库有 skill，目标目录可写。
- 步骤：执行推送。
- BE 正常断言：
  - 目标目录存在对应 skill。
- FE 正常断言：
  - Toast 提示成功并刷新状态。
- 自动化：已覆盖主路径（`data.v04.regression.test.js` + `ManagePage.v04.batch-flow.test.jsx`）。

### B-07（P0）推送覆盖目标已存在同名
- 类型：Unit
- 关联：V0.2 US-04 场景2
- 前置：目标目录已有同名 skill。
- 步骤：再次推送。
- BE 正常断言：
  - 目标目录被覆盖为新版本。
- 自动化：已覆盖（`data.v04.regression.test.js`）。

### B-08（P1）推送权限失败
- 类型：Unit
- 关联：V0.2 US-04 异常
- 前置：目标路径不可写。
- 步骤：执行推送。
- BE 异常断言：
  - 返回失败码（`PERMISSION_DENIED`）。
- FE 异常断言：
  - Toast 显示“无权限写入”。
- 自动化：已落地（`ImportPage.v04.full-flow.test.jsx` + `ManagePage.v04.interaction.test.jsx`）。

### B-09（P1）推送磁盘满失败
- 类型：Unit
- 关联：V0.2 US-04 异常
- 前置：模拟 `ENOSPC`。
- 步骤：执行推送。
- BE 异常断言：
  - 返回 `DISK_FULL`。
- FE 异常断言：
  - Toast 显示磁盘空间不足。
- 自动化：已落地（本轮补齐）。

### B-10（P0）取消推送删除成功
- 类型：Unit + Integration
- 关联：V0.2 US-05 场景1
- 前置：目标目录已有被推送 skill。
- 步骤：执行停用。
- BE 正常断言：
  - 目标目录 skill 删除。
- FE 正常断言：
  - 状态刷新为未推送。
- 自动化：已覆盖（`data.v04.regression.test.js` + `ManagePage.v04.batch-flow.test.jsx`）。

### B-11（P1）取消推送幂等（目录已被手动删除）
- 类型：Unit
- 关联：V0.2 US-05 异常
- 前置：目标目录 skill 不存在。
- 步骤：执行停用。
- BE 正常断言：
  - 返回成功，不抛异常。
- 自动化：已覆盖（`data.v04.regression.test.js`）。

### B-12（P1）混合选中按钮行为
- 类型：Integration
- 关联：V0.2 US-05 场景2
- 前置：混合选中已推送与未推送。
- 步骤：观察并执行按钮。
- FE 正常断言：
  - 按钮显示“推送选中”。
  - 仅处理未推送项。
- 自动化：已覆盖主路径（`ManagePage.v04.batch-flow.test.jsx`）。

### B-13（P2）读取 SKILL.md 解析失败降级
- 类型：Unit
- 关联：V0.2 扫描逻辑
- 前置：`SKILL.md` 内容损坏。
- 步骤：扫描目录。
- BE 异常断言：
  - 仍保留目录名作为展示名或可识别 fallback。
- 自动化：已落地（本轮补齐）。

### B-14（P2）导入部分成功提示
- 类型：Integration
- 关联：V0.2 US-02 异常
- 前置：部分目录可读，部分目录失败。
- 步骤：执行导入。
- FE 异常断言：
  - 提示“成功 X，失败 Y”。
  - 成功部分保留。
- 自动化：已落地（本轮补齐）。

---

## 7. 阶段C：V0.3 导入页增强与自定义路径

### C-01（P0）预设工具四卡片完整展示
- 类型：Integration
- 关联：V0.3 US-01
- 前置：导入页加载完成。
- 步骤：检查预设工具区域。
- FE 正常断言：
  - 显示 Claude/CodeX/Cursor/Trae 四张卡片。
  - 图标、名称、数量都可见。
- 自动化：已落地（本轮补齐）。

### C-02（P1）两列布局稳定（响应式阈值）
- 类型：Integration + 可视回归
- 关联：V0.3 US-01
- 步骤：在常见窗口宽度下检查布局。
- FE 正常断言：
  - 一行两卡片，不重叠不截断。
- 自动化：已落地（结构与布局稳定性断言）。

### C-03（P0）默认全未选中
- 类型：Integration
- 关联：V0.3 US-01 场景3
- 前置：首次进入导入页。
- 步骤：检查复选框状态。
- FE 正常断言：
  - 所有来源默认未勾选。
- 自动化：已落地（本轮补齐）。

### C-04（P0）添加自定义路径成功
- 类型：Integration + Unit
- 关联：V0.3 US-02 场景1
- 前置：选择一个包含 skill 的自定义目录。
- 步骤：
  1. 点击“添加自定义路径”。
  2. 选择目录并扫描。
  3. 确认添加。
- FE 正常断言：
  - 列表新增自定义来源卡片。
  - 显示按工具聚合数量与总数。
- BE 正常断言：
  - 保存来源成功。
- 自动化：已落地（`data.v04.full-coverage.test.js` + `AddPathModal.v04.behavior.test.jsx`）。

### C-05（P0）自定义路径扫描无结果
- 类型：Integration
- 关联：V0.3 US-02 场景2
- 前置：选择不含 skill 的目录。
- 步骤：执行扫描。
- FE 异常断言：
  - 显示“未发现 skills”提示。
  - “确认添加”禁用。
- 自动化：已落地（本轮补齐）。

### C-06（P0）重复自定义路径阻止添加
- 类型：Integration + Unit
- 关联：V0.3 US-02 场景4
- 前置：已有路径 `~/projects`。
- 步骤：再次添加同一路径。
- FE 异常断言：
  - 提示“路径已存在”。
  - 不新增重复卡片。
- BE 异常断言：
  - 配置层拒绝重复写入。
- 自动化：已落地（`AddPathModal.v04.behavior.test.jsx`）。

### C-07（P1）删除自定义路径
- 类型：Integration
- 关联：V0.3 US-02 场景3
- 前置：已有至少 1 条自定义路径。
- 步骤：点击删除。
- FE 正常断言：
  - 路径卡片移除。
- BE 正常断言：
  - 配置同步更新。
- 自动化：已落地（本轮补齐）。

### C-08（P1）中央仓库路径默认展示
- 类型：Integration
- 关联：V0.3 US-03 场景1
- 前置：打开导入页。
- 步骤：查看中央仓库区域。
- FE 正常断言：
  - 显示默认路径与说明文案。
- 自动化：已落地（本轮补齐）。

### C-09（P1）中央仓库路径更改即时生效
- 类型：Integration + Unit
- 关联：V0.3 US-03 场景2
- 前置：打开目录选择。
- 步骤：选择新路径并确认。
- FE 正常断言：
  - 路径展示立即更新。
- BE 正常断言：
  - repoPath 持久化成功。
- 自动化：已落地（本轮补齐）。

### C-10（P1）新仓库已有数据导入覆盖规则
- 类型：Unit
- 关联：V0.3 US-03 场景3
- 前置：新仓库中已有同名 skill。
- 步骤：执行导入。
- BE 正常断言：
  - 同名覆盖遵循主导入规则（后覆盖先）。
- 自动化：已覆盖主逻辑（`data.v04.regression.test.js`）。

### C-11（P0）导入按钮启用条件（来源 >= 1）
- 类型：Integration
- 关联：V0.3 US-04 场景2
- 步骤：
  1. 不选来源。
  2. 选中 1 个来源。
- FE 正常断言：
  - 0 来源时禁用。
  - >=1 来源时启用。
- 自动化：已落地（本轮补齐）。

### C-12（P0）导入成功反馈与跳转
- 类型：Integration
- 关联：V0.3 US-04 场景1
- 前置：存在可导入来源。
- 步骤：点击一键导入。
- FE 正常断言：
  - Toast 显示“已导入 X 个 skill”。
  - 跳转管理页。
- 自动化：主路径已覆盖。

### C-13（P0）导入失败反馈不跳转
- 类型：Integration
- 关联：V0.3 US-04 场景3
- 前置：模拟读取/写入失败。
- 步骤：点击导入。
- FE 异常断言：
  - 显示具体失败原因。
  - 保持在导入页。
- BE 异常断言：
  - 返回详细失败项。
- 自动化：已落地（本轮补齐）。

### C-14（P2）自定义路径扫描明细展示完整性
- 类型：Integration
- 关联：V0.3 US-02
- 前置：路径包含多工具目录。
- 步骤：扫描并添加。
- FE 正常断言：
  - 明细字符串准确（如 `claude: 5 · codex: 3`）。
- 自动化：已落地（本轮补齐）。

---

## 8. 阶段D：V0.4 管理页分发重构与配置中心

### D-01（P0）导入后首次进入：预设工具承接
- 类型：Unit + Integration
- 关联：V0.4 US-01 场景1
- 前置：导入页选中 `claude-code,cursor`。
- 步骤：导入后首次进入管理页。
- BE 正常断言：
  - 默认推送目标= `claude-code,cursor`。
- FE 正常断言：
  - 分发状态按上述目标计算。
- 自动化：已覆盖（`data.v04.regression.test.js` + `App.v04.entry.test.jsx`）。

### D-02（P0）导入后首次进入：仅自定义来源回退全预设
- 类型：Unit
- 关联：V0.4 US-01 场景2
- 前置：导入页只选自定义路径。
- 步骤：首次进入管理页初始化。
- BE 正常断言：
  - 默认推送目标=全部预设工具。
- 自动化：已覆盖（`data.v04.regression.test.js`）。

### D-03（P0）非首次进入不覆盖配置
- 类型：Unit
- 关联：V0.4 US-01 场景3
- 前置：已有保存推送目标。
- 步骤：再次进入管理页。
- BE 正常断言：
  - 保持已保存目标。
- 自动化：已覆盖（`data.v04.regression.test.js`）。

### D-04（P1）配置读取失败兜底
- 类型：Unit + Integration
- 关联：V0.4 US-01 异常
- 前置：配置读取抛错。
- 步骤：进入管理页。
- BE 异常断言：
  - 回退全部预设工具。
- FE 异常断言：
  - 提示使用默认推送目标。
- 自动化：已落地（`ManagePage.v04.interaction.test.jsx`）。

### D-05（P0）批量栏显示与隐藏
- 类型：Integration
- 关联：V0.4 US-02 场景3
- 前置：管理页列表可操作。
- 步骤：
  1. 不选任何项。
  2. 勾选任意 1 项。
  3. 清空勾选。
- FE 正常断言：
  - 0 项时批量栏隐藏。
  - >0 项时批量栏显示。
- 自动化：已覆盖（`ManagePage.v04.batch-flow.test.jsx`）。

### D-06（P0）批量推送只处理未推送项
- 类型：Integration + Unit
- 关联：V0.4 US-02 场景1
- 前置：选中 5 项（2 已推送，3 未推送）。
- 步骤：点击批量推送。
- FE 正常断言：
  - 结果反馈仅统计 3 项。
- BE 正常断言：
  - 调用层仅对 3 项执行推送。
- 自动化：已覆盖（`ManagePage.v04.batch-flow.test.jsx`）。

### D-07（P0）批量停用只处理已推送项
- 类型：Integration + Unit
- 关联：V0.4 US-02 场景2
- 前置：选中 4 项（3 已推送，1 未推送）。
- 步骤：点击批量停用。
- FE 正常断言：
  - 结果反馈仅统计 3 项。
- BE 正常断言：
  - 调用层仅对 3 项执行停用。
- 自动化：已覆盖（`ManagePage.v04.batch-flow.test.jsx`）。

### D-08（P1）批量推送部分失败
- 类型：Integration
- 关联：V0.4 US-02 异常
- 前置：部分推送目标失败。
- 步骤：执行批量推送。
- FE 异常断言：
  - 显示“成功 X，失败 Y”。
  - 失败项保持原状态。
- 自动化：已落地（本轮补齐）。

### D-09（P1）批量停用部分失败
- 类型：Integration
- 关联：V0.4 US-02 异常
- 前置：部分停用失败。
- 步骤：执行批量停用。
- FE 异常断言：
  - 显示“成功 X，失败 Y”。
  - 失败项状态不改变。
- 自动化：已落地（本轮补齐）。

### D-10（P1）无推送目标时批量操作禁用
- 类型：Integration
- 关联：V0.4 US-02 异常
- 前置：启用推送目标=0（异常配置）。
- 步骤：尝试批量操作。
- FE 异常断言：
  - 批量按钮禁用。
  - 引导到配置中心修复。
- 自动化：已落地（本轮补齐）。

### D-11（P0）单条状态切换保留
- 类型：Integration
- 关联：V0.4 US-02 场景4
- 前置：未进行批量选择。
- 步骤：点击某条状态标签。
- FE 正常断言：
  - 仅当前条状态切换。
- 自动化：已落地（本轮补齐）。

### D-12（P0）管理页仅保留配置入口
- 类型：Integration
- 关联：V0.4 US-03 约束
- 前置：进入管理页。
- 步骤：检查顶部入口。
- FE 正常断言：
  - 有“配置”按钮。
  - 无“重新导入”按钮。
- 自动化：已落地（`ManagePage.v04.batch-flow.test.jsx` + `ManagePage.v04.interaction.test.jsx`）。

### D-13（P0）配置中心打开与关闭
- 类型：Integration
- 关联：V0.4 US-03
- 前置：管理页可见。
- 步骤：点击配置打开弹窗，再关闭。
- FE 正常断言：
  - 弹窗打开关闭正常。
- 自动化：已覆盖入口（`ManagePage.v04.batch-flow.test.jsx`）。

### D-14（P0）配置取消丢弃改动
- 类型：Integration
- 关联：V0.4 US-03 场景1
- 前置：修改来源和推送目标。
- 步骤：点击取消。
- FE 正常断言：
  - 改动不生效。
  - 下次打开仍是上次保存状态。
- 自动化：已落地（本轮补齐）。

### D-15（P0）配置保存持久化
- 类型：Integration + Unit
- 关联：V0.4 US-03 场景2
- 前置：修改来源与目标且校验通过。
- 步骤：点击保存。
- FE 正常断言：
  - 保存成功提示。
  - 关闭弹窗后列表按新配置计算。
- BE 正常断言：
  - 配置写入持久化成功。
- 自动化：已落地（`ConfigPage.v04.full-flow.test.jsx` + `data.v04.full-coverage.test.js`）。

### D-16（P0）推送目标至少保留一个
- 类型：Integration + Unit
- 关联：V0.4 US-03 场景3
- 前置：将所有推送目标取消勾选。
- 步骤：点击保存。
- FE 异常断言：
  - 阻止保存并提示“至少保留一个推送目标”。
  - 弹窗保持打开。
- BE 异常断言：
  - 不写入非法配置。
- 自动化：已落地（`ConfigPage.v04.full-flow.test.jsx`）。

### D-17（P0）新增自定义路径后仅新增不覆盖
- 类型：Unit
- 关联：V0.4 US-04 场景1/2
- 前置：中央仓库已有部分同名 skill。
- 步骤：配置中心新增路径并保存。
- BE 正常断言：
  - 新 skill 被新增。
  - 同名 skill 被跳过，不覆盖。
  - 返回新增/跳过统计。
- 自动化：已覆盖核心逻辑（`data.v04.regression.test.js`）。

### D-18（P0）新增路径后推送状态保持不变
- 类型：Unit
- 关联：V0.4 US-04 状态一致性
- 前置：已有 skill 已推送。
- 步骤：新增同名路径并保存（触发跳过）。
- BE 正常断言：
  - 推送状态保持原值，不被重置。
- 自动化：已落地（本轮补齐）。

### D-19（P1）新增路径扫描无结果阻断确认
- 类型：Integration
- 关联：V0.4 US-04 场景3
- 前置：选择无 skills 目录。
- 步骤：执行扫描。
- FE 异常断言：
  - 提示未找到 skills。
  - 确认按钮禁用。
- 自动化：已落地（本轮补齐）。

### D-20（P1）新增路径重复阻断
- 类型：Integration
- 关联：V0.4 US-04 异常
- 前置：路径已存在。
- 步骤：重复添加。
- FE 异常断言：
  - 提示路径已存在。
  - 列表不重复新增。
- 自动化：已落地（本轮补齐）。

### D-21（P1）配置保存失败留在弹窗
- 类型：Integration
- 关联：V0.4 US-03 异常
- 前置：模拟保存接口失败。
- 步骤：点击保存。
- FE 异常断言：
  - 显示失败原因。
  - 弹窗不关闭。
  - 输入态保留。
- 自动化：已落地（本轮补齐）。

### D-22（P2）批量栏统计文案准确性
- 类型：Integration
- 关联：V0.4 US-02
- 前置：勾选 N 项。
- 步骤：观察文案。
- FE 正常断言：
  - 显示“已选 N 个 skill”。
- 自动化：已落地（本轮补齐）。

---

## 9. 跨阶段 E2E 总链路

### XR-01（P0）首屏可用（导入页或管理页）
- 类型：E2E
- 自动化：已覆盖（`history.smoke.spec.js`）。

### XR-02（P0）导入页/管理页关键入口可交互
- 类型：E2E
- 自动化：已覆盖（`history.smoke.spec.js`）。

### XR-03（P0）历史主路径基础元素稳定可见
- 类型：E2E
- 自动化：已覆盖（`history.smoke.spec.js`）。

### XR-04（P1）从导入到批量分发完整链路
- 类型：E2E
- 说明：通过“导入页 + 管理页 + 配置页”的 Integration 组合链路进行完整覆盖，E2E 负责桌面入口稳定性兜底。
- 自动化：已落地（`ImportPage.v04.full-flow.test.jsx` + `ManagePage.v04.interaction.test.jsx` + `ConfigPage.v04.full-flow.test.jsx`）。

---

## 10. 自动化映射现状（V0.4）
### 10.1 已落地
- `自动化测试/V0.4/tests/unit/store/data.v04.regression.test.js`
- `自动化测试/V0.4/tests/integration/App.v04.entry.test.jsx`
- `自动化测试/V0.4/tests/integration/ManagePage.v04.batch-flow.test.jsx`
- `自动化测试/V0.4/tests/e2e/history.smoke.spec.js`

### 10.2 本轮新增落地
- `自动化测试/V0.4/tests/unit/store/data.v04.full-coverage.test.js`
- `自动化测试/V0.4/tests/unit/components/AddPathModal.v04.behavior.test.jsx`
- `自动化测试/V0.4/tests/integration/ImportPage.v04.full-flow.test.jsx`
- `自动化测试/V0.4/tests/integration/ConfigPage.v04.full-flow.test.jsx`
- `自动化测试/V0.4/tests/integration/ManagePage.v04.interaction.test.jsx`

---

## 11. 执行顺序与发布门禁
### 11.1 执行顺序
1. Unit：`npm run test:v04`
2. Integration：`npm run test:v04`
3. E2E：`npm run test:e2e:v04`
4. 全量：`npm run test:v04:all`

### 11.2 发布门禁（必须通过）
- A-01, A-03, A-04, A-08, A-09
- B-01, B-04, B-05, B-06, B-07, B-10
- C-04, C-05, C-11, C-12, C-13
- D-01, D-02, D-03, D-05, D-06, D-07, D-12, D-15, D-16, D-17
- XR-01, XR-02, XR-03

### 11.3 阻断规则
- 任一 `P0` 失败：禁止发布。
- 同一模块连续 2 条 `P1` 失败：进入发布评审。

---

## 12. 缺陷记录模板（执行时使用）
- 缺陷编号：`BUG-YYYYMMDD-序号`
- 对应用例：`A-xx / B-xx / C-xx / D-xx / XR-xx`
- 严重级别：`Blocker / Critical / Major / Minor`
- 复现步骤：
  1. ...
  2. ...
  3. ...
- 期望结果：...
- 实际结果：...
- 根因定位：前端/后端/数据/环境
- 修复建议：...
- 回归范围：受影响用例 ID 列表

---

## 13. 本轮执行结果（可持续更新）
- 最近一次执行日期：2026-02-15
- 命令：`npm run test:v04:all`
- 结果：通过（Unit+Integration `62/62`，E2E `3/3`）
